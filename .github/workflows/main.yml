#workflow runs in standard 'IDE' format dismissing syntaxes errors on [',",{,},",and,] <allow source="home/usr/bin_temp=ignore syntax errors"/>
in [1]:
 run: 
  pip3 install cython
  pip3 install neuro-pypes 

 cells: 
   cell_type: "code"
   "execution_count": 1,
   "metadata": {}
   outputs: 
    name: stdout
     "output_type": "stream",
     "text": [
      "Collecting cython\n",
      "  Using cached https://files.pythonhosted.org/packages/19/49/91ebe4a00bf894d08dd9680cd9dfb05936eb2848eebd9402b43885aa74cf/Cython-0.29.21-cp36-cp36m-manylinux1_x86_64.whl\n",
      "Installing collected packages: cython\n",
      "Successfully installed cython-0.29.21\n",
      "Collecting neuro-pypes\n",
      "Collecting boyle>=0.2.0 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/aa/39/5ea8fa4e422258be3b3bc0dfa0693d3356626fb1172c51464e3218c9e5e8/boyle-0.2.0-py3-none-any.whl\n",
      "Collecting nibabel>=2.2.1 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/42/bf/ba089fec67237f6439c345b8977ca6dde67402ada6592bf84c2c78d557ff/nibabel-3.2.1-py3-none-any.whl\n",
      "Collecting nipy>=0.4.2 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/55/97/4dfcc0c4aa1b448d4dcf78041e85b42e600e35b7a06a6d389a6fa33ac9e3/nipy-0.4.2-cp36-cp36m-manylinux1_x86_64.whl\n",
      "Collecting click>=6.7 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/d2/3d/fa76db83bf75c4f8d338c2fd15c8d33fdd7ad23a9b5e57eb6c5de26b430e/click-7.1.2-py2.py3-none-any.whl\n",
      "Collecting hansel>=2.0.1 (from neuro-pypes)\n",
      "Collecting nilearn>=0.4.0 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/e8/e7/59fcd3501f47b7a661a69e15ef417463fbc88dd334d9af2d9d6685710038/nilearn-0.7.0-py3-none-any.whl\n",
      "Collecting scipy>=1.0.0 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/c8/89/63171228d5ced148f5ced50305c89e8576ffc695a90b58fe5bb602b910c2/scipy-1.5.4-cp36-cp36m-manylinux1_x86_64.whl\n",
      "Collecting pydicom>=1.0.1 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/f4/15/df16546bc59bfca390cf072d473fb2c8acd4231636f64356593a63137e55/pydicom-2.1.2-py3-none-any.whl\n",
      "Collecting matplotlib==2.1.0 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/b2/9c/fcc9cfbf2454d93be66a615657cda4184954b4b67b9fc07c8511ff152b8f/matplotlib-2.1.0-cp36-cp36m-manylinux1_x86_64.whl\n",
      "Collecting kaptan==0.5.9 (from neuro-pypes)\n",
      "Collecting nipype>=1.0.2 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/1f/0e/348956e47dfa73e359c55f9249d61fdd0526ab24d761a0b94299b1a9f88b/nipype-1.6.0-py3-none-any.whl\n",
      "Collecting pandas>=0.22.0 (from neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/c3/e2/00cacecafbab071c787019f00ad84ca3185952f6bb9bca9550ed83870d4d/pandas-1.1.5-cp36-cp36m-manylinux1_x86_64.whl\n",
      "Collecting scikit-learn>=0.19.1 (from neuro-pypes)\n",
      "Requirement already satisfied: numpy in /home/noobron/project_env/venv/lib/python3.6/site-packages (from boyle>=0.2.0->neuro-pypes)\n",
      "Requirement already satisfied: packaging>=14.3 in /home/noobron/project_env/venv/lib/python3.6/site-packages (from nibabel>=2.2.1->neuro-pypes)\n",
      "Collecting sympy>=0.7.0 (from nipy>=0.4.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/ff/69/b16fc81b939d3efdd0b552f2e3e54f7fa1423d0c320cced2e69e675dde26/sympy-1.7.1-py3-none-any.whl\n",
      "Collecting requests>=2 (from nilearn>=0.4.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/29/c1/24814557f1d22c56d50280771a17307e6bf87b70727d975fd6b2ce6b014a/requests-2.25.1-py2.py3-none-any.whl\n",
      "Collecting joblib>=0.12 (from nilearn>=0.4.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/34/5b/bd0f0fb5564183884d8e35b81d06d7ec06a20d1a0c8b4c407f1554691dce/joblib-1.0.0-py3-none-any.whl\n",
      "Requirement already satisfied: python-dateutil>=2.0 in /home/noobron/project_env/venv/lib/python3.6/site-packages (from matplotlib==2.1.0->neuro-pypes)\n",
      "Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /home/noobron/project_env/venv/lib/python3.6/site-packages (from matplotlib==2.1.0->neuro-pypes)\n",
      "Requirement already satisfied: six>=1.10 in /home/noobron/project_env/venv/lib/python3.6/site-packages (from matplotlib==2.1.0->neuro-pypes)\n",
      "Collecting cycler>=0.10 (from matplotlib==2.1.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/f7/d2/e07d3ebb2bd7af696440ce7e754c59dd546ffe1bbe732c8ab68b9c834e61/cycler-0.10.0-py2.py3-none-any.whl\n",
      "Collecting pytz (from matplotlib==2.1.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/89/06/2c2d3034b4d6bf22f2a4ae546d16925898658a33b4400cfb7e2c1e2871a3/pytz-2020.5-py2.py3-none-any.whl\n",
      "Collecting PyYAML==3.12 (from kaptan==0.5.9->neuro-pypes)\n",
      "Collecting simplejson>=3.8.0 (from nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/c4/76/6c18cafdd84cb87ea737ec52965dc1d8730f0d8e8d019c1efaf0b58abb32/simplejson-3.17.2-cp36-cp36m-manylinux1_x86_64.whl\n",
      "Collecting networkx>=2.0 (from nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/9b/cd/dc52755d30ba41c60243235460961fc28022e5b6731f16c268667625baea/networkx-2.5-py3-none-any.whl\n",
      "Collecting pydot>=1.2.3 (from nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/33/d1/b1479a770f66d962f545c2101630ce1d5592d90cb4f083d38862e93d16d2/pydot-1.4.1-py2.py3-none-any.whl\n",
      "Collecting traits!=5.0,>=4.6 (from nipype>=1.0.2->neuro-pypes)\n",
      "Collecting etelemetry>=0.2.0 (from nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/13/f9/e8e8cd04bdc44dfba28a3b2cc4d0b1efe8cbf3afc1bf12b11f1c9d697f1e/etelemetry-0.2.2-py3-none-any.whl\n",
      "Collecting rdflib>=5.0.0 (from nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/d0/6b/6454aa1db753c0f8bc265a5bd5c10b5721a4bb24160fb4faf758cf6be8a1/rdflib-5.0.0-py3-none-any.whl\n",
      "Collecting prov>=1.5.2 (from nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/cf/8d/9a5110845c6b117d203e3ca9eec5ee79bed29cef508c8415fbc85e900150/prov-2.0.0-py3-none-any.whl\n",
      "Collecting filelock>=3.0.0 (from nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/93/83/71a2ee6158bb9f39a90c0dea1637f81d5eef866e188e1971a1b1ab01a35a/filelock-3.0.12-py3-none-any.whl\n",
      "Collecting threadpoolctl>=2.0.0 (from scikit-learn>=0.19.1->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/f7/12/ec3f2e203afa394a149911729357aa48affc59c20e2c1c8297a60f33f133/threadpoolctl-2.1.0-py3-none-any.whl\n",
      "Collecting mpmath>=0.19 (from sympy>=0.7.0->nipy>=0.4.2->neuro-pypes)\n",
      "Collecting chardet<5,>=3.0.2 (from requests>=2->nilearn>=0.4.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/19/c7/fa589626997dd07bd87d9269342ccb74b1720384a4d739a1872bd84fbe68/chardet-4.0.0-py2.py3-none-any.whl\n",
      "Collecting idna<3,>=2.5 (from requests>=2->nilearn>=0.4.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/a2/38/928ddce2273eaa564f6f50de919327bf3a00f091b5baba8dfa9460f3a8a8/idna-2.10-py2.py3-none-any.whl\n",
      "Collecting urllib3<1.27,>=1.21.1 (from requests>=2->nilearn>=0.4.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/f5/71/45d36a8df68f3ebb098d6861b2c017f3d094538c0fb98fa61d4dc43e69b9/urllib3-1.26.2-py2.py3-none-any.whl\n",
      "Collecting certifi>=2017.4.17 (from requests>=2->nilearn>=0.4.0->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/5e/a0/5f06e1e1d463903cf0c0eebeb751791119ed7a4b3737fdc9a77f1cdfb51f/certifi-2020.12.5-py2.py3-none-any.whl\n",
      "Requirement already satisfied: decorator>=4.3.0 in /home/noobron/project_env/venv/lib/python3.6/site-packages (from networkx>=2.0->nipype>=1.0.2->neuro-pypes)\n",
      "Collecting ci-info>=0.2 (from etelemetry>=0.2.0->nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/cf/01/664a10490000d7154fa71358af87681696b8116a12d869a267063c470fbc/ci_info-0.2.0-py3-none-any.whl\n",
      "Collecting isodate (from rdflib>=5.0.0->nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/9b/9f/b36f7774ff5ea8e428fdcfc4bb332c39ee5b9362ddd3d40d9516a55221b2/isodate-0.6.0-py2.py3-none-any.whl\n",
      "Collecting lxml>=3.3.5 (from prov>=1.5.2->nipype>=1.0.2->neuro-pypes)\n",
      "  Using cached https://files.pythonhosted.org/packages/bd/78/56a7c88a57d0d14945472535d0df9fb4bbad7d34ede658ec7961635c790e/lxml-4.6.2-cp36-cp36m-manylinux1_x86_64.whl\n",
      "Installing collected packages: pydicom, nibabel, scipy, boyle, mpmath, sympy, nipy, click, hansel, threadpoolctl, joblib, scikit-learn, pytz, pandas, chardet, idna, urllib3, certifi, requests, nilearn, cycler, matplotlib, PyYAML, kaptan, simplejson, networkx, pydot, traits, ci-info, etelemetry, isodate, rdflib, lxml, prov, filelock, nipype, neuro-pypes\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Successfully installed PyYAML-3.12 boyle-0.2.0 certifi-2020.12.5 chardet-4.0.0 ci-info-0.2.0 click-7.1.2 cycler-0.10.0 etelemetry-0.2.2 filelock-3.0.12 hansel-2.0.1 idna-2.10 isodate-0.6.0 joblib-1.0.0 kaptan-0.5.9 lxml-4.6.2 matplotlib-2.1.0 mpmath-1.1.0 networkx-2.5 neuro-pypes-1.1.2 nibabel-3.2.1 nilearn-0.7.0 nipy-0.4.2 nipype-1.6.0 pandas-1.1.5 prov-2.0.0 pydicom-2.1.2 pydot-1.4.1 pytz-2020.5 rdflib-5.0.0 requests-2.25.1 scikit-learn-0.24.0 scipy-1.5.4 simplejson-3.17.2 sympy-1.7.1 threadpoolctl-2.1.0 traits-6.1.1 urllib3-1.26.2\r\n"
     ]
    }
   ],
   "source": [
    "!pip3 install cython\n",
    "!pip3 install neuro-pypes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "\n",
    "from hansel import Crumb\n",
    "from neuro_pypes.run import run_debug, run_wf\n",
    "from neuro_pypes.config import update_config\n",
    "from neuro_pypes.io import build_crumb_workflow\n",
    "from neuro_pypes.anat import attach_spm_anat_preprocessing"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/home/noobron/rough/mri_pre_process/data/{subject_id}/session_1/{modality}/{image}\n",
      "['sub_001']\n",
      "['mr_img.nii', 'mr_img.nii.gz']\n"
     ]
    }
   ],
   "source": [
    "# root path to my data\n",
    "base_dir = os.getcwd() + \"/data\"\n",
    "\n",
    "# the configuration file path\n",
    "config_file_path = \"pypes_config.yml\"\n",
    "\n",
    "# define the Crumb filetree of my image database\n",
    "data_path = os.path.join(base_dir, \"{subject_id}\", \"session_1\", \"{modality}\", \"{image}\")\n",
    "\n",
    "# create the filetree Crumb object\n",
    "data_crumb = Crumb(data_path, ignore_list=[\".*\"])\n",
    "print(data_crumb)\n",
    "print(data_crumb['subject_id'])\n",
    "print(data_crumb['image'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "# the different worflows that I will use with any given name\n",
    "attach_functions = {\"spm_anat_preproc\": attach_spm_anat_preprocessing}\n",
    "\n",
    "# the specific parts of the `data_crumb` that define a given modality.\n",
    "# **Note**: the key values of this `crumb_arguments` must be the same as expected\n",
    "# in the functions in `attach_functions`.\n",
    "crumb_arguments = {'anat': [('modality', 'anat_1'),\n",
    "                            ('image', 'mr_img.nii.gz')]\n",
    "                  }\n",
    "\n",
    "# the pypes configuration file with workflow parameter values\n",
    "update_config(config_file_path)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:root:Using the following configuration parameters:\n",
      "INFO:root:<config.Config> (('spm_dir', '~/Software/matlab_tools/spm12')\n",
      "('normalize_atlas', False)\n",
      "('atlas_file', '')\n",
      "('anat_preproc.do_cortical_thickness', True)\n",
      "('direct.convergence', '[45,0.0,10]')\n",
      "('direct.gradient_step', 0.025)\n",
      "('direct.smoothing_variance', 1.0)\n",
      "('direct.smoothing_velocity_field', 1.5)\n",
      "('direct.use_bspline_smoothing', False)\n",
      "('direct.number_integration_points', 10)\n",
      "('direct.thickness_prior_estimate', 10)\n",
      "('registration.anat2pet', False)\n",
      "('registration.anat2fmri', False)\n",
      "('extract_b0.max_b', 0.0)\n",
      "('dmri.artifact_detect', True)\n",
      "('dmri.apply_nlmeans', True)\n",
      "('coreg_b0.write_interp', 3)\n",
      "('nlmeans_denoise.N', 12)\n",
      "('conmat.tract_stat', 'mean')\n",
      "('track.curvethresh', 50)\n",
      "('track.anisthresh', 0.2)\n",
      "('coreg_rest.write_interp', 3)\n",
      "('trim.begin_index', 5)\n",
      "('rest_input.lowpass_freq', 0.1)\n",
      "('rest_input.highpass_freq', 0.01)\n",
      "('smooth_fmri.fwhm', 8)\n",
      "('rest_filter.compcor_csf', True)\n",
      "('rest_filter.compcor_wm', False)\n",
      "('rest_filter.gsr', False)\n",
      "('motion_regressors.order', 0)\n",
      "('motion_regressors.derivatives', 1)\n",
      "('motart_parameters.detrend_poly', 2)\n",
      "('tsnr.regress_poly', 2)\n",
      "('detect_artifacts.use_differences', [True, False])\n",
      "('detect_artifacts.parameter_source', 'NiPy')\n",
      "('detect_artifacts.mask_type', 'file')\n",
      "('detect_artifacts.use_norm', True)\n",
      "('detect_artifacts.zintensity_threshold', 3)\n",
      "('detect_artifacts.norm_threshold', 1)\n",
      "('compcor_pars.num_components', 6)\n",
      "('gsr_pars.num_components', 1)\n",
      "('rest_preproc.canica', False)\n",
      "('canica.algorithm', 'canica')\n",
      "('canica.do_cca', True)\n",
      "('canica.standardize', True)\n",
      "('canica.n_components', 20)\n",
      "('canica.threshold', 2.0)\n",
      "('canica.smoothing_fwhm', 8)\n",
      "('canica_extra.plot', True)\n",
      "('canica_extra.plot_thr', 2.0)\n",
      "('rest_preproc.connectivity', True)\n",
      "('rest_connectivity.standardize', False)\n",
      "('rest_connectivity.kind', 'correlation')\n",
      "('rest_connectivity.smoothing_fwhm', 8)\n",
      "('rest_connectivity.atlas_type', 'labels')\n",
      "('stc_input.slice_mode', 'alt_inc')\n",
      "('stc_input.time_repetition', 2)\n",
      "('fmri_warp.write_voxel_sizes', [2, 2, 2])\n",
      "('fmri_grptemplate_warp.write_voxel_sizes', [2, 2, 2])\n",
      "('spm_epi_grouptemplate_smooth.fwhm', 8)\n",
      "('spm_epi_grouptemplate_smooth.template_file', '')\n",
      "('spm_pet_grouptemplate_smooth.fwhm', 8)\n",
      "('spm_pet_grouptemplate.template_file', '')\n",
      "('spm_mrpet_grouptemplate_smooth.fwhm', 8)\n",
      "('spm_mrpet_grouptemplate.do_petpvc', True)\n",
      "('spm_mrpet_grouptemplate.template_file', '')\n",
      "('rbvpvc.pvc', 'RBV')\n",
      "('rbvpvc.fwhm_x', 4.3)\n",
      "('rbvpvc.fwhm_y', 4.3)\n",
      "('rbvpvc.fwhm_z', 4.3)\n",
      "('cortical_thickness.brain_template', '/home/pyper/data/std_brains/templates/NKI/T_template.nii.gz')\n",
      "('cortical_thickness.brain_probability_mask', '/home/pyper/data/std_brains/templates/NKI/T_templateProbabilityMask.nii.gz')\n",
      "('cortical_thickness.segmentation_priors', ['/home/pyper/data/std_brains/templates/NKI/Priors/priors1.nii.gz', '/home/pyper/data/std_brains/templates/NKI/Priors/priors2.nii.gz', '/home/pyper/data/std_brains/templates/NKI/Priors/priors3.nii.gz', '/home/pyper/data/std_brains/templates/NKI/Priors/priors4.nii.gz'])\n",
      "('cortical_thickness.t1_registration_template', '/home/pyper/data/std_brains/templates/NKI/T_template_BrainCerebellum.nii.gz'))\n",
      "INFO:root:Workflow created.\n"
     ]
    }
   ],
   "source": [
    "# output and working directory paths\n",
    "output_dir = os.path.join(os.path.dirname(base_dir), \"out\")\n",
    "cache_dir  = os.path.join(os.path.dirname(base_dir), \"wd\")\n",
    "\n",
    "# build the workflow\n",
    "wf = build_crumb_workflow(attach_functions,\n",
    "                          data_crumb=data_crumb,\n",
    "                          in_out_kwargs=crumb_arguments,\n",
    "                          output_dir=output_dir,\n",
    "                          cache_dir=cache_dir,)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:02,804 nipype.workflow INFO:\n",
      "\t Workflow main_workflow settings: ['check', 'execution', 'logging', 'monitoring']\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:Workflow main_workflow settings: ['check', 'execution', 'logging', 'monitoring']\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:02,968 nipype.workflow INFO:\n",
      "\t Running in parallel.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:Running in parallel.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:03,77 nipype.workflow INFO:\n",
      "\t [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 6.94/6.94, Free processors: 8/8.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 6.94/6.94, Free processors: 8/8.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:03,197 nipype.workflow INFO:\n",
      "\t [Job 9] Cached (main_workflow.spm_anat_preproc.tpm_bbox).\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Job 9] Cached (main_workflow.spm_anat_preproc.tpm_bbox).\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:03,198 nipype.workflow INFO:\n",
      "\t [Node] Setting-up \"main_workflow.selectfiles\" in \"/home/noobron/rough/mri_pre_process/wd/main_workflow/_subject_id_sub_001/selectfiles\".\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Node] Setting-up \"main_workflow.selectfiles\" in \"/home/noobron/rough/mri_pre_process/wd/main_workflow/_subject_id_sub_001/selectfiles\".\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:03,306 nipype.workflow INFO:\n",
      "\t [Node] Running \"selectfiles\" (\"neuro_pypes.crumb.DataCrumb\")\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Node] Running \"selectfiles\" (\"neuro_pypes.crumb.DataCrumb\")\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:03,336 nipype.workflow INFO:\n",
      "\t [Node] Finished \"main_workflow.selectfiles\".\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Node] Finished \"main_workflow.selectfiles\".\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:05,46 nipype.workflow INFO:\n",
      "\t [Job 0] Completed (main_workflow.selectfiles).\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Job 0] Completed (main_workflow.selectfiles).\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:05,55 nipype.workflow INFO:\n",
      "\t [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 6.94/6.94, Free processors: 8/8.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 6.94/6.94, Free processors: 8/8.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:05,128 nipype.workflow INFO:\n",
      "\t [Job 8] Cached (main_workflow.joinpath).\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Job 8] Cached (main_workflow.joinpath).\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:05,129 nipype.workflow INFO:\n",
      "\t [Node] Setting-up \"main_workflow.spm_anat_preproc.bias_correction\" in \"/home/noobron/rough/mri_pre_process/wd/main_workflow/spm_anat_preproc/_subject_id_sub_001/bias_correction\".\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Node] Setting-up \"main_workflow.spm_anat_preproc.bias_correction\" in \"/home/noobron/rough/mri_pre_process/wd/main_workflow/spm_anat_preproc/_subject_id_sub_001/bias_correction\".\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:05,183 nipype.workflow INFO:\n",
      "\t [Node] Running \"bias_correction\" (\"nipype.interfaces.ants.segmentation.N4BiasFieldCorrection\"), a CommandLine Interface with command:\n",
      "N4BiasFieldCorrection --bspline-fitting [ 300 ] -d 3 --input-image /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz --convergence [ 50x50x30x20, 1e-06 ] --output [ mr_img_corrected.nii.gz, mr_img_bias.nii.gz ] --shrink-factor 3\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[Node] Running \"bias_correction\" (\"nipype.interfaces.ants.segmentation.N4BiasFieldCorrection\"), a CommandLine Interface with command:\n",
      "N4BiasFieldCorrection --bspline-fitting [ 300 ] -d 3 --input-image /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz --convergence [ 50x50x30x20, 1e-06 ] --output [ mr_img_corrected.nii.gz, mr_img_bias.nii.gz ] --shrink-factor 3\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:06,423 nipype.workflow WARNING:\n",
      "\t Storing result file without outputs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:nipype.workflow:Storing result file without outputs\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:06,435 nipype.workflow WARNING:\n",
      "\t [Node] Error on \"main_workflow.spm_anat_preproc.bias_correction\" (/home/noobron/rough/mri_pre_process/wd/main_workflow/spm_anat_preproc/_subject_id_sub_001/bias_correction)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:nipype.workflow:[Node] Error on \"main_workflow.spm_anat_preproc.bias_correction\" (/home/noobron/rough/mri_pre_process/wd/main_workflow/spm_anat_preproc/_subject_id_sub_001/bias_correction)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:07,49 nipype.workflow ERROR:\n",
      "\t Node bias_correction.a0 failed to run on host noobron08.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "ERROR:nipype.workflow:Node bias_correction.a0 failed to run on host noobron08.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:07,55 nipype.workflow ERROR:\n",
      "\t Saving crash info to /home/noobron/rough/mri_pre_process/wd/main_workflow/log/crash-20201229-130407-noobron-bias_correction.a0-ebed6c4f-7daa-4df9-b17e-c50d421ca9f8.pklz\n",
      "Traceback (most recent call last):\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/multiproc.py\", line 148, in __init__\n",
      "    mp_context=mp_context,\n",
      "TypeError: __init__() got an unexpected keyword argument 'initializer'\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/multiproc.py\", line 67, in run_node\n",
      "    result[\"result\"] = node.run(updatehash=updatehash)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 516, in run\n",
      "    result = self._run_interface(execute=True)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 635, in _run_interface\n",
      "    return self._run_command(execute)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 741, in _run_command\n",
      "    result = self._interface.run(cwd=outdir)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 434, in run\n",
      "    runtime = self._run_interface(runtime)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 829, in _run_interface\n",
      "    self.raise_exception(runtime)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 760, in raise_exception\n",
      "    ).format(**runtime.dictcopy())\n",
      "RuntimeError: Command:\n",
      "N4BiasFieldCorrection --bspline-fitting [ 300 ] -d 3 --input-image /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz --convergence [ 50x50x30x20, 1e-06 ] --output [ mr_img_corrected.nii.gz, mr_img_bias.nii.gz ] --shrink-factor 3\n",
      "Standard output:\n",
      "\n",
      "Standard error:\n",
      "Exception caught during reference file reading \n",
      "\n",
      "itk::ImageFileReaderException (0x55b652a9aa30)\n",
      "Location: \"unknown\" \n",
      "File: /home/noobron/Downloads/install-ants/build/staging/include/ITK-5.2/itkImageFileReader.hxx\n",
      "Line: 133\n",
      "Description:  Could not create IO object for reading file /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz\n",
      "  Tried to create one of the following:\n",
      "    BMPImageIO\n",
      "    BioRadImageIO\n",
      "    Bruker2dseqImageIO\n",
      "    GDCMImageIO\n",
      "    GE4ImageIO\n",
      "    GE5ImageIO\n",
      "    GiplImageIO\n",
      "    HDF5ImageIO\n",
      "    JPEGImageIO\n",
      "    JPEG2000ImageIO\n",
      "    LSMImageIO\n",
      "    MGHImageIO\n",
      "    MINCImageIO\n",
      "    MRCImageIO\n",
      "    MetaImageIO\n",
      "    NiftiImageIO\n",
      "    NrrdImageIO\n",
      "    PNGImageIO\n",
      "    StimulateImageIO\n",
      "    TIFFImageIO\n",
      "    VTKImageIO\n",
      "  You probably failed to set a file suffix, or\n",
      "    set the suffix to an unsupported type.\n",
      "\n",
      "\n",
      " file /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz\n",
      "Segmentation fault (core dumped)\n",
      "Return code: 139\n",
      "\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "ERROR:nipype.workflow:Saving crash info to /home/noobron/rough/mri_pre_process/wd/main_workflow/log/crash-20201229-130407-noobron-bias_correction.a0-ebed6c4f-7daa-4df9-b17e-c50d421ca9f8.pklz\n",
      "Traceback (most recent call last):\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/multiproc.py\", line 148, in __init__\n",
      "    mp_context=mp_context,\n",
      "TypeError: __init__() got an unexpected keyword argument 'initializer'\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/multiproc.py\", line 67, in run_node\n",
      "    result[\"result\"] = node.run(updatehash=updatehash)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 516, in run\n",
      "    result = self._run_interface(execute=True)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 635, in _run_interface\n",
      "    return self._run_command(execute)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 741, in _run_command\n",
      "    result = self._interface.run(cwd=outdir)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 434, in run\n",
      "    runtime = self._run_interface(runtime)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 829, in _run_interface\n",
      "    self.raise_exception(runtime)\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 760, in raise_exception\n",
      "    ).format(**runtime.dictcopy())\n",
      "RuntimeError: Command:\n",
      "N4BiasFieldCorrection --bspline-fitting [ 300 ] -d 3 --input-image /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz --convergence [ 50x50x30x20, 1e-06 ] --output [ mr_img_corrected.nii.gz, mr_img_bias.nii.gz ] --shrink-factor 3\n",
      "Standard output:\n",
      "\n",
      "Standard error:\n",
      "Exception caught during reference file reading \n",
      "\n",
      "itk::ImageFileReaderException (0x55b652a9aa30)\n",
      "Location: \"unknown\" \n",
      "File: /home/noobron/Downloads/install-ants/build/staging/include/ITK-5.2/itkImageFileReader.hxx\n",
      "Line: 133\n",
      "Description:  Could not create IO object for reading file /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz\n",
      "  Tried to create one of the following:\n",
      "    BMPImageIO\n",
      "    BioRadImageIO\n",
      "    Bruker2dseqImageIO\n",
      "    GDCMImageIO\n",
      "    GE4ImageIO\n",
      "    GE5ImageIO\n",
      "    GiplImageIO\n",
      "    HDF5ImageIO\n",
      "    JPEGImageIO\n",
      "    JPEG2000ImageIO\n",
      "    LSMImageIO\n",
      "    MGHImageIO\n",
      "    MINCImageIO\n",
      "    MRCImageIO\n",
      "    MetaImageIO\n",
      "    NiftiImageIO\n",
      "    NrrdImageIO\n",
      "    PNGImageIO\n",
      "    StimulateImageIO\n",
      "    TIFFImageIO\n",
      "    VTKImageIO\n",
      "  You probably failed to set a file suffix, or\n",
      "    set the suffix to an unsupported type.\n",
      "\n",
      "\n",
      " file /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz\n",
      "Segmentation fault (core dumped)\n",
      "Return code: 139\n",
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:07,62 nipype.workflow INFO:\n",
      "\t [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 6.94/6.94, Free processors: 8/8.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:[MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 6.94/6.94, Free processors: 8/8.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:09,48 nipype.workflow INFO:\n",
      "\t ***********************************\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:***********************************\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:09,56 nipype.workflow ERROR:\n",
      "\t could not run node: main_workflow.spm_anat_preproc.bias_correction.a0\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "ERROR:nipype.workflow:could not run node: main_workflow.spm_anat_preproc.bias_correction.a0\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:09,59 nipype.workflow INFO:\n",
      "\t crashfile: /home/noobron/rough/mri_pre_process/wd/main_workflow/log/crash-20201229-130407-noobron-bias_correction.a0-ebed6c4f-7daa-4df9-b17e-c50d421ca9f8.pklz\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:crashfile: /home/noobron/rough/mri_pre_process/wd/main_workflow/log/crash-20201229-130407-noobron-bias_correction.a0-ebed6c4f-7daa-4df9-b17e-c50d421ca9f8.pklz\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "201229-13:04:09,62 nipype.workflow INFO:\n",
      "\t ***********************************\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:nipype.workflow:***********************************\n"
     ]
    },
    {
     "ename": "RuntimeError",
     "evalue": "Workflow did not execute cleanly. Check log for details",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mRuntimeError\u001b[0m                              Traceback (most recent call last)",
      "\u001b[0;32m<ipython-input-5-3085431f1ffe>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mrun_wf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mwf\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mplugin\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"MultiProc\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mn_cpus\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m8\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[0;32m~/.local/lib/python3.6/site-packages/neuro_pypes/run.py\u001b[0m in \u001b[0;36mrun_wf\u001b[0;34m(wf, plugin, n_cpus, **plugin_kwargs)\u001b[0m\n\u001b[1;32m     26\u001b[0m     \u001b[0;31m# run the workflow according to `plugin`\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     27\u001b[0m     \u001b[0;32mif\u001b[0m \u001b[0mplugin\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0;34m\"MultiProc\"\u001b[0m \u001b[0;32mor\u001b[0m \u001b[0mn_cpus\u001b[0m \u001b[0;34m>\u001b[0m \u001b[0;36m1\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 28\u001b[0;31m         \u001b[0mwf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mrun\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"MultiProc\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mplugin_args\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m{\u001b[0m\u001b[0;34m\"n_procs\"\u001b[0m\u001b[0;34m:\u001b[0m \u001b[0mn_cpus\u001b[0m\u001b[0;34m}\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     29\u001b[0m     \u001b[0;32melif\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0mplugin\u001b[0m \u001b[0;32mor\u001b[0m \u001b[0mplugin\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mNone\u001b[0m \u001b[0;32mor\u001b[0m \u001b[0mn_cpus\u001b[0m \u001b[0;34m<=\u001b[0m \u001b[0;36m1\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     30\u001b[0m         \u001b[0mwf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mrun\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mplugin\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mNone\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/.local/lib/python3.6/site-packages/nipype/pipeline/engine/workflows.py\u001b[0m in \u001b[0;36mrun\u001b[0;34m(self, plugin, plugin_args, updatehash)\u001b[0m\n\u001b[1;32m    630\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mstr2bool\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mconfig\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"execution\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"create_report\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    631\u001b[0m             \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_write_report_info\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbase_dir\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mname\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mexecgraph\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 632\u001b[0;31m         \u001b[0mrunner\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mrun\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mexecgraph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mupdatehash\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mupdatehash\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mconfig\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mconfig\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    633\u001b[0m         \u001b[0mdatestr\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdatetime\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mutcnow\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mstrftime\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"%Y%m%dT%H%M%S\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    634\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mstr2bool\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mconfig\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"execution\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"write_provenance\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/base.py\u001b[0m in \u001b[0;36mrun\u001b[0;34m(self, graph, config, updatehash)\u001b[0m\n\u001b[1;32m    190\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    191\u001b[0m         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_remove_node_dirs\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 192\u001b[0;31m         \u001b[0mreport_nodes_not_run\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mnotrun\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    193\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    194\u001b[0m         \u001b[0;31m# close any open resources\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/tools.py\u001b[0m in \u001b[0;36mreport_nodes_not_run\u001b[0;34m(notrun)\u001b[0m\n\u001b[1;32m     96\u001b[0m         \u001b[0mlogger\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0minfo\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"***********************************\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     97\u001b[0m         raise RuntimeError(\n\u001b[0;32m---> 98\u001b[0;31m             \u001b[0;34m(\u001b[0m\u001b[0;34m\"Workflow did not execute cleanly. \"\u001b[0m \u001b[0;34m\"Check log for details\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     99\u001b[0m         )\n\u001b[1;32m    100\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mRuntimeError\u001b[0m: Workflow did not execute cleanly. Check log for details"
     ]
    }
   ],
   "source": [
    "run_wf(wf, plugin=\"MultiProc\", n_cpus=8)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\r\n",
      "\r\n",
      "File: /home/noobron/rough/mri_pre_process/wd/main_workflow/log/crash-20201227-014456-noobron-bias_correction.a0-ba07d82c-5871-4b52-8944-731424df1276.pklz\r\n",
      "Node: main_workflow.spm_anat_preproc.bias_correction\r\n",
      "Working directory: /home/noobron/rough/mri_pre_process/wd/main_workflow/spm_anat_preproc/_subject_id_sub_001/bias_correction\r\n",
      "\r\n",
      "\r\n",
      "Node inputs:\r\n",
      "\r\n",
      "args = <undefined>\r\n",
      "bias_image = <undefined>\r\n",
      "bspline_fitting_distance = 300.0\r\n",
      "bspline_order = <undefined>\r\n",
      "convergence_threshold = 1e-06\r\n",
      "copy_header = False\r\n",
      "dimension = 3\r\n",
      "environ = {'NSLOTS': '1'}\r\n",
      "histogram_sharpening = <undefined>\r\n",
      "input_image = <undefined>\r\n",
      "mask_image = <undefined>\r\n",
      "n_iterations = [50, 50, 30, 20]\r\n",
      "num_threads = 1\r\n",
      "output_image = <undefined>\r\n",
      "rescale_intensities = False\r\n",
      "save_bias = True\r\n",
      "shrink_factor = 3\r\n",
      "weight_image = <undefined>\r\n",
      "\r\n",
      "\r\n",
      "\r\n",
      "Traceback: \r\n",
      "Traceback (most recent call last):\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/multiproc.py\", line 148, in __init__\r\n",
      "    mp_context=mp_context,\r\n",
      "TypeError: __init__() got an unexpected keyword argument 'initializer'\r\n",
      "\r\n",
      "During handling of the above exception, another exception occurred:\r\n",
      "\r\n",
      "Traceback (most recent call last):\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/plugins/multiproc.py\", line 67, in run_node\r\n",
      "    result[\"result\"] = node.run(updatehash=updatehash)\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 516, in run\r\n",
      "    result = self._run_interface(execute=True)\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 635, in _run_interface\r\n",
      "    return self._run_command(execute)\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/pipeline/engine/nodes.py\", line 741, in _run_command\r\n",
      "    result = self._interface.run(cwd=outdir)\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 434, in run\r\n",
      "    runtime = self._run_interface(runtime)\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 829, in _run_interface\r\n",
      "    self.raise_exception(runtime)\r\n",
      "  File \"/home/noobron/.local/lib/python3.6/site-packages/nipype/interfaces/base/core.py\", line 760, in raise_exception\r\n",
      "    ).format(**runtime.dictcopy())\r\n",
      "RuntimeError: Command:\r\n",
      "N4BiasFieldCorrection --bspline-fitting [ 300 ] -d 3 --input-image /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz --convergence [ 50x50x30x20, 1e-06 ] --output [ mr_img_corrected.nii.gz, mr_img_bias.nii.gz ] --shrink-factor 3\r\n",
      "Standard output:\r\n",
      "\r\n",
      "Standard error:\r\n",
      "Exception caught during reference file reading \r\n",
      "\r\n",
      "itk::ImageFileReaderException (0x559a5b6cba30)\r\n",
      "Location: \"unknown\" \r\n",
      "File: /home/noobron/Downloads/install-ants/build/staging/include/ITK-5.2/itkImageFileReader.hxx\r\n",
      "Line: 133\r\n",
      "Description:  Could not create IO object for reading file /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz\r\n",
      "  Tried to create one of the following:\r\n",
      "    BMPImageIO\r\n",
      "    BioRadImageIO\r\n",
      "    Bruker2dseqImageIO\r\n",
      "    GDCMImageIO\r\n",
      "    GE4ImageIO\r\n",
      "    GE5ImageIO\r\n",
      "    GiplImageIO\r\n",
      "    HDF5ImageIO\r\n",
      "    JPEGImageIO\r\n",
      "    JPEG2000ImageIO\r\n",
      "    LSMImageIO\r\n",
      "    MGHImageIO\r\n",
      "    MINCImageIO\r\n",
      "    MRCImageIO\r\n",
      "    MetaImageIO\r\n",
      "    NiftiImageIO\r\n",
      "    NrrdImageIO\r\n",
      "    PNGImageIO\r\n",
      "    StimulateImageIO\r\n",
      "    TIFFImageIO\r\n",
      "    VTKImageIO\r\n",
      "  You probably failed to set a file suffix, or\r\n",
      "    set the suffix to an unsupported type.\r\n",
      "\r\n",
      "\r\n",
      " file /home/noobron/rough/mri_pre_process/data/sub_001/session_1/anat_1/mr_img.nii.gz\r\n",
      "Segmentation fault (core dumped)\r\n",
      "Return code: 139\r\n",
      "\r\n",
      "\r\n",
      "\r\n"
     ]
    }
   ],
   "source": [
    "!nipypecli crash /home/noobron/rough/mri_pre_process/wd/main_workflow/log/crash-20201227-014456-noobron-bias_correction.a0-ba07d82c-5871-4b52-8944-731424df1276.pklz"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}  
